<!DOCTYPE html>
<html>
    <head>
        <title>Лабораторная работа 5</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    </head>

    <body>
        <p><textarea id="first_text_code_input" cols="26" rows="8"></textarea></p>
        <input type="button" id="first_text_input_button" value="Загрузить код">
        
        <table id="first_image_table" border="1" cellpadding="15">
        
        <p><table id="first_image_code_table" border="1"></p>
        
        <p><textarea id="first_text_code_output" cols="26" rows="8"></textarea></p>
        <input type="button" id="first_text_output_button" value="Получить код">
    </body>

    <style>
        canvas {
            border: 1px dashed black;
        }
    </style>

    <script>      
        var J = 8;
        var I = 5;
        var first_image = [];

        //table type:
        var color_table_type = "color_table";
        var code_table_type = "code_table";
        //

        function load_code_in_table(text_field_id, color_table_id, code_table_id, data) {
            var text = document.getElementById(text_field_id).value;
            var result = [];
            for (var i = 0; i < text.length; ++i) {
                if (text[i-1]+text[i] == "-1") {
                    result.push(-1);
                }
                else if (text[i] == "1"){
                    result.push(1);
                }
            }
            if (result.length != J*I){
                alert("Ошибка в поле ввода – длина не соответствует размерности матрицы.");
                return;
            }
            data = result;
            update_table(color_table_id, data, color_table_type);
            update_table(code_table_id, data, code_table_type);
        }

        first_botton_input = document.getElementById("first_text_input_button");
        first_botton_input.onclick = function() {
            load_code_in_table("first_text_code_input", "first_image_table" ,"first_image_code_table", first_image);
        }

        first_botton_output = document.getElementById("first_text_output_button");
        first_botton_output.onclick = function() { 
            update_text_field("first_text_code_output", first_image);
        }

        window.onload = function() {
            for (var i = 0; i < J*I; ++i) {
                first_image[i] = -1;
            }
            table_init(first_image);
            update_text_field("first_text_code_output", first_image);
        }

        function table_init(first_image) {
            var table1 = document.getElementById('first_image_table');
            for (var j = 0; j < J; ++j) {
                var row = document.createElement("tr");
                for (var i = 0; i < I; ++i) {
                    var cell = document.createElement("td");
                    cell.id = "t1c" + j.toString() + i.toString();
                    cell.addEventListener("click", function(){ 
                        
                        row_num = parseInt(this.parentElement.firstChild.id.substr(3,1), 10);
                        cell_num = this.cellIndex;

                        var id = this.id;
                        var t1_code_cell_id = id.substr(0,2) + "\'" + id.substr(2);
                        t1_code_cell = document.getElementById(t1_code_cell_id);

                        if (this.bgColor == "black") {this.bgColor = "white"; first_image[((row_num) * I ) + cell_num] = -1; t1_code_cell.innerHTML = "-1"; }
                        else {this.bgColor = "black"; first_image[((row_num) * I ) + cell_num] = 1; t1_code_cell.innerHTML = "1"; }
                    });
                    row.appendChild(cell);
                }
                table1.appendChild(row);
            }

            var table1_code = document.getElementById('first_image_code_table');
            for (var j = 0; j < J; ++j) {
                var row = document.createElement("tr");
                for (var i = 0; i < I; ++i) {
                    var cell = document.createElement("td");
                    var cell_text = document.createTextNode(first_image[i*j]);
                    cell.appendChild(cell_text);
                    cell.width = 30-2;
                    cell.height = 30-2;
                    cell.id = "t1'c" + j.toString() + i.toString();
                    row.appendChild(cell);
                }
                table1_code.appendChild(row);
            }
        }

        function update_table(table_id, data, table_type) {
            var table = document.getElementById(table_id);
            var rows = table.getElementsByTagName("tr");
            for (var i = 0; i < rows.length; ++i) {
                row = rows[i].children;
                for (var j = 0; j < row.length; ++j) {
                    if (table_type == code_table_type) {
                        row[j].innerHTML = data[i*I+j];
                    }
                    else if (table_type == color_table_type) {
                        if (data[i*I+j] == 1) {
                            row[j].bgColor = "black";
                        }
                        else {
                            row[j].bgColor = "white";
                        }
                    }
                }
            }
        }

        // обновляет текстовое поле вывода 
        function update_text_field(text_field_id, data) {
            var text_field = document.getElementById(text_field_id);
            text_field.value = data;
        }

    </script>
</html>