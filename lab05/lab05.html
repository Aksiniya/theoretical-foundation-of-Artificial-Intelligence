<!DOCTYPE html>
<html>
    <head>
        <title>Лабораторная работа 5</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    </head>

    <body>
        <table id="first_image_table" border="1" cellpadding="15">
        <p><table id="first_image_code_table" border="1"></p>
            
        <p><textarea id="first_text_code" cols="26" rows="8"></textarea></p>
        <input type="button" id="first_text_output_button" value="Код!">
    </body>

    <style>
        canvas {
            border: 1px dashed black;
        }
    </style>

    <script>      
        var J = 8;
        var I = 5;
        var first_image = [0];

        first_botton_output = document.getElementById("first_text_output_button");
        first_botton_output.onclick = function() { 

            var first_image_code_in_string = "[ ";
            for (var i = 0; i < first_image.length; ++i){
                // console.log(first_image[i].toString());
                first_image_code_in_string += first_image[i].toString() + ", ";
            }
            first_image_code_in_string = first_image_code_in_string.substr(0, first_image_code_in_string.length-2) + " ]";
            console.log(first_image_code_in_string);

            update_first_text_field(first_image);
        }

        window.onload = function() {
            for (var i = 0; i < J*I; ++i) {
                first_image[i] = 0;
            }
            table_init(first_image);
            update_first_text_field(first_image);

        }

        function table_init(first_image) {
            var table1 = document.getElementById('first_image_table');
            for (var j = 0; j < J; ++j) {
                var row = document.createElement("tr");
                for (var i = 0; i < I; ++i) {
                    var cell = document.createElement("td");
                    cell.id = "t1c" + j.toString() + i.toString();
                    cell.addEventListener("click", function(){ 
                        
                        row_num = parseInt(this.parentElement.firstChild.id.substr(3,1), 10);
                        cell_num = this.cellIndex;

                        var id = this.id;
                        var t1_code_cell_id = id.substr(0,2) + "\'" + id.substr(2);
                        t1_code_cell = document.getElementById(t1_code_cell_id);

                        if (this.bgColor == "black") {this.bgColor = "white"; first_image[((row_num) * I ) + cell_num] = 0; t1_code_cell.innerHTML = "0"; }
                        else {this.bgColor = "black"; first_image[((row_num) * I ) + cell_num] = 1; t1_code_cell.innerHTML = "1"; }
                        var tmp = "";
                        for (var i = 0; i < first_image.length; ++i) {
                            tmp += first_image[i].toString();
                        }
                        console.log(tmp);
                    });
                    row.appendChild(cell);
                }
                table1.appendChild(row);
            }

            var table1_code = document.getElementById('first_image_code_table');
            for (var j = 0; j < J; ++j) {
                var row = document.createElement("tr");
                for (var i = 0; i < I; ++i) {
                    var cell = document.createElement("td");
                    var cell_text = document.createTextNode(first_image[i*j]);
                    cell.appendChild(cell_text);
                    cell.width = 30-2;
                    cell.height = 30-2;
                    cell.id = "t1'c" + j.toString() + i.toString();
                    row.appendChild(cell);
                }
                table1_code.appendChild(row);
            }
        }

        function update_first_text_field(first_image){
            var first_text_field = document.getElementById("first_text_code");
            var first_image_code_in_string = "[ ";
            for (var i = 0; i < first_image.length; ++i){
                first_image_code_in_string += first_image[i].toString() + ", ";
            }
            first_image_code_in_string = first_image_code_in_string.substr(0, first_image_code_in_string.length-2) + " ]";
            first_text_field.innerHTML = first_image_code_in_string;
        }

    </script>
</html>