<!DOCTYPE html>
<html>
    <head>
        <title>Лабораторная работа 5</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    </head>

    <body>
        <p><textarea id="first_text_code_input" cols="26" rows="8"></textarea></p>
        <input type="button" id="first_text_input_button" value="Загрузить код">
        
        <table id="first_image_table" border="1" cellpadding="15">
        
        <p><table id="first_image_code_table" border="1"></p>
        
        <p><textarea id="first_text_code_output" cols="26" rows="8"></textarea></p>
        <input type="button" id="first_text_output_button" value="Получить код">
    </body>

    <style>
        canvas {
            border: 1px dashed black;
        }
    </style>

    <script>      
        var J = 8;
        var I = 5;
        var first_image = [0];

        first_botton_input = document.getElementById("first_text_input_button");
        first_botton_input.onclick = function() {
            var text = document.getElementById("first_text_code_input").value;
            // var input_text_field = document.getElementById("first_text_code_input");
            var result = [];
            for (var i = 0; i < text.length; ++i) {
                if (text[i-1]+text[i] == "-1") {
                    result.push(-1);
                }
                else if (text[i] == "1"){
                    result.push(1);
                }
            }
            if (result.length != J*I){
                alert("Ошибка в поле ввода – длина не соответствует размерности матрицы.");
                return;
            }
            first_image = result;
            // console.log(first_image);
            update_table("first_image_table", first_image);
        }

        first_botton_output = document.getElementById("first_text_output_button");
        first_botton_output.onclick = function() { 
            // var first_image_code_in_string = "[ ";
            // for (var i = 0; i < first_image.length; ++i){
            //     first_image_code_in_string += first_image[i].toString() + ", ";
            // }
            // first_image_code_in_string = first_image_code_in_string.substr(0, first_image_code_in_string.length-2) + " ]";
            // console.log(first_image_code_in_string);
            // console.log(first_image);
            update_text_field("first_text_code_output", first_image);
        }


        window.onload = function() {
            for (var i = 0; i < J*I; ++i) {
                first_image[i] = -1;
            }
            table_init(first_image);
            update_text_field("first_text_code_output" ,first_image);
        }

        function table_init(first_image) {
            var table1 = document.getElementById('first_image_table');
            for (var j = 0; j < J; ++j) {
                var row = document.createElement("tr");
                for (var i = 0; i < I; ++i) {
                    var cell = document.createElement("td");
                    cell.id = "t1c" + j.toString() + i.toString();
                    cell.addEventListener("click", function(){ 
                        
                        row_num = parseInt(this.parentElement.firstChild.id.substr(3,1), 10);
                        cell_num = this.cellIndex;

                        var id = this.id;
                        var t1_code_cell_id = id.substr(0,2) + "\'" + id.substr(2);
                        t1_code_cell = document.getElementById(t1_code_cell_id);

                        if (this.bgColor == "black") {this.bgColor = "white"; first_image[((row_num) * I ) + cell_num] = -1; t1_code_cell.innerHTML = "-1"; }
                        else {this.bgColor = "black"; first_image[((row_num) * I ) + cell_num] = 1; t1_code_cell.innerHTML = "1"; }
                        // var tmp = "";
                        // for (var i = 0; i < first_image.length; ++i) {
                        //     tmp += first_image[i].toString();
                        // }
                        // console.log(tmp);
                    });
                    row.appendChild(cell);
                }
                table1.appendChild(row);
            }

            var table1_code = document.getElementById('first_image_code_table');
            for (var j = 0; j < J; ++j) {
                var row = document.createElement("tr");
                for (var i = 0; i < I; ++i) {
                    var cell = document.createElement("td");
                    var cell_text = document.createTextNode(first_image[i*j]);
                    cell.appendChild(cell_text);
                    cell.width = 30-2;
                    cell.height = 30-2;
                    cell.id = "t1'c" + j.toString() + i.toString();
                    row.appendChild(cell);
                }
                table1_code.appendChild(row);
            }
        }

        function update_table(table_id, data){
            var table = document.getElementById(table_id).childNodes;
            for (var i = 1; i < table.length; ++i) {
                row = table[i];
                for(var j = 0; j < row.childNodes.length; ++j) {
                    if (data[((i-1)*I)+j] == 1) {
                        row.childNodes[j].bgColor = "black";
                    }
                    else {
                        row.childNodes[j].bgColor = "white";
                    }
                }
            }
        }

        // обновляет текстовое поле вывода 
        function update_text_field(text_field_id, data) {
            var text_field = document.getElementById(text_field_id);
            text_field.innerHTML = data;
        }

    </script>
</html>